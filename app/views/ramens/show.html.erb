<div class="container-fluid">
  <div class = "card-list-container py-3">
    <h2><strong><%= @ramen.shop_name %></strong></h2>
    <div class="card w-75 mx-auto mt-4 shadow-lg">
      <%= attachment_image_tag @ramen, :image ,class:"card-img-top";%>
      <div class = "card-body">
        <div class = "row">
          <p class = "card-title">
            <div class= "ramenmap">
              <%= @ramen.prefecture_name %><%= @ramen.city %><%= @ramen.street %></br>
            </div>
            #<%= @ramen.category.name %>
            <%= @ramen.parking_lot_i18n %>
          </p>
        </div>
        <div>
          <% if @ramen.user == current_user %>
            <%= link_to "削除", ramen_path(@ramen), method: :delete %>
          <% end %>
          <div class=<%= "favorite_buttons_" + @ramen.id.to_s %>>
            <%= render "favorites/favorites_btn", ramen: @ramen %>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="comment_all">
    <%= render "post_comments/comment_table", ramen: @ramen ,post_comment: @post_comment %>
  </div>
  <div>
    <%# URL が正しく生成されないため %>
    <%= form_with(model:[@ramen, @post_comment], url: ramen_post_comments_path(@ramen.id)) do |f| %>
      <%= f.text_area :comment, rows:'5',placeholder: "コメントをここに" %>
      <div class="star-form-group" id="star1">
        <%= f.label :rate,'評価', class:'star-title' %>
      </div>
      <% if user_signed_in? %>
        <%= f.submit "送信する" %>
      <% else %>
        <p>ログインしていないとコメントできません</p>
      <% end %>
    <% end %>
  </div>
</div>

<div id='map'></div>

<style>
#map {
  height: 400px;
  width: 400px;
}
</style>


<script>
$('#star1').raty({
  size     : 38,
  starOff:  '<%= asset_path('star-off.png') %>',
  starOn : '<%= asset_path('star-on.png') %>',
  starHalf: '<%= asset_path('star-half.png') %>',
  scoreName: 'post_comment[rate]',    //カラムに保存
  half: true,
});

function initMap() {

  var target = document.getElementById('map'); //マップを表示する要素を指定
  var address = '<%= @ramen.prefecture_name %><%= @ramen.city %><%= @ramen.street %>'; //住所を指定
  var geocoder = new google.maps.Geocoder();

  geocoder.geocode({ address: address }, function(results, status){
    if (status === 'OK' && results[0]){

      console.log(results[0].geometry.location);

       var map = new google.maps.Map(target, {
         center: results[0].geometry.location,
         zoom: 18
       });

       var marker = new google.maps.Marker({
         position: results[0].geometry.location,
         map: map,
         animation: google.maps.Animation.DROP
       });

    }else{
      //住所が存在しない場合の処理
      alert('住所が正しくないか存在しません。');
      target.style.display='none';
    }
  });
}
</script>


<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap" async defer></script>